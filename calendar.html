<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Awards Calendar</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: white;
            text-decoration: none;
            font-weight: 600;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .filters h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .filter-btn:hover {
            background: #f5f5f5;
        }
        
        .filter-btn.active {
            background: #764ba2;
            color: white;
            border-color: #764ba2;
        }
        
        .event-list {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .event-item {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid;
        }
        
        .event-uksua { border-left-color: #764ba2; background: #f3f0ff; }
        .event-gbea { border-left-color: #0ea5e9; background: #eff6ff; }
        .event-gbia { border-left-color: #10b981; background: #f0fdf4; }
        .event-fgi { border-left-color: #f59e0b; background: #fffbeb; }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .event-date {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
        }
        
        .event-award {
            font-weight: 700;
            color: #666;
        }
        
        .event-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .event-description {
            color: #666;
            font-size: 0.95em;
        }
        
        .channel-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .channel-email { background: #e3f2fd; color: #1976d2; }
        .channel-call { background: #f3e5f5; color: #7b1fa2; }
        .channel-whatsapp { background: #e8f5e9; color: #388e3c; }
        .channel-social { background: #fff3e0; color: #f57c00; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.3em;
        }
        
        .no-events {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Loading calendar from Firebase...</div>
    
    <div class="container" id="mainContent" style="display: none;">
        <a href="index.html" class="back-link">‚Üê Back to All Awards</a>
        
        <div class="header">
            <h1>üìÖ Unified Awards Calendar</h1>
            <p>All communications across all awards programs - automatically calculated from your key dates</p>
        </div>
        
        <div class="filters">
            <h3>Filter Events</h3>
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterByAward('all')">All Awards</button>
                <button class="filter-btn" onclick="filterByAward('UKSUA')">UKSUA</button>
                <button class="filter-btn" onclick="filterByAward('GBEA')">GBEA</button>
                <button class="filter-btn" onclick="filterByAward('GBIA')">GBIA</button>
                <button class="filter-btn" onclick="filterByAward('FGI')">FGI</button>
            </div>
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterByChannel('all')">All Channels</button>
                <button class="filter-btn" onclick="filterByChannel('email')">üìß Email</button>
                <button class="filter-btn" onclick="filterByChannel('call')">üìû Call</button>
                <button class="filter-btn" onclick="filterByChannel('whatsapp')">üí¨ WhatsApp</button>
                <button class="filter-btn" onclick="filterByChannel('social')">üì± Social</button>
            </div>
        </div>
        
        <div class="event-list">
            <h2 style="margin-bottom: 20px; color: #333;">Upcoming Communications</h2>
            <div id="eventsList"></div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyBR7eBBCds2Qy_YxCmmG60KF0_nax9MZHY",
          authDomain: "ideas-forums-programme-plan.firebaseapp.com",
          projectId: "ideas-forums-programme-plan",
          storageBucket: "ideas-forums-programme-plan.firebasestorage.app",
          messagingSenderId: "94219941404",
          appId: "1:94219941404:web:78cc7a290dd99baf0b51d9",
          measurementId: "G-9D6EGHBXJ6"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let allEvents = [];
        let currentAwardFilter = 'all';
        let currentChannelFilter = 'all';
        
        // Helper function to add days to a date
        function addDays(dateString, days) {
            if (!dateString) return null;
            const date = new Date(dateString);
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }
        
        // Helper function to subtract days from a date
        function subtractDays(dateString, days) {
            if (!dateString) return null;
            const date = new Date(dateString);
            date.setDate(date.getDate() - days);
            return date.toISOString().split('T')[0];
        }
        
        // Generate events for UKSUA
        function generateUKSUAEvents(dates) {
            const events = [];
            
            if (dates.applicationDeadline) {
                // Pre-deadline events
                events.push({
                    date: subtractDays(dates.applicationDeadline, 42),
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'Cold Outreach Campaign Starts',
                    description: 'Begin cold email outreach to startups'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 28),
                    award: 'UKSUA',
                    channel: 'social',
                    title: 'Paid Social Campaign Launch',
                    description: 'Start paid social media advertising'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 2),
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'Final Deadline Reminder',
                    description: 'Last chance email to abandoned applications'
                });
                
                events.push({
                    date: dates.applicationDeadline,
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'Application Deadline',
                    description: 'Applications close today'
                });
            }
            
            if (dates.shortlistDate) {
                events.push({
                    date: dates.shortlistDate,
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'Shortlist Announcement',
                    description: 'Announce shortlisted companies'
                });
                
                events.push({
                    date: addDays(dates.shortlistDate, 2),
                    award: 'UKSUA',
                    channel: 'call',
                    title: 'Personal Congratulations Calls',
                    description: 'Call shortlisted companies'
                });
            }
            
            // Regional finals
            for (let i = 1; i <= 10; i++) {
                const regionKey = 'region' + i;
                if (dates[regionKey]) {
                    const regionNames = {
                        region1: 'North East',
                        region2: 'North West',
                        region3: 'Yorkshire & Humber',
                        region4: 'East Midlands',
                        region5: 'West Midlands',
                        region6: 'East of England',
                        region7: 'London',
                        region8: 'South East',
                        region9: 'South West',
                        region10: 'Scotland, Wales & NI'
                    };
                    
                    events.push({
                        date: subtractDays(dates[regionKey], 14),
                        award: 'UKSUA',
                        channel: 'email',
                        title: `${regionNames[regionKey]} - Pre-Event Email`,
                        description: 'Event details and networking tips'
                    });
                    
                    events.push({
                        date: subtractDays(dates[regionKey], 2),
                        award: 'UKSUA',
                        channel: 'whatsapp',
                        title: `${regionNames[regionKey]} - Event Reminder`,
                        description: 'Final reminder and logistics'
                    });
                    
                    events.push({
                        date: dates[regionKey],
                        award: 'UKSUA',
                        channel: 'social',
                        title: `${regionNames[regionKey]} Regional Final`,
                        description: 'Live event coverage and winner announcements'
                    });
                }
            }
            
            if (dates.nationalDate) {
                events.push({
                    date: subtractDays(dates.nationalDate, 30),
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'National Final - VIP Experience Email',
                    description: 'Premium experience details for finalists'
                });
                
                events.push({
                    date: subtractDays(dates.nationalDate, 7),
                    award: 'UKSUA',
                    channel: 'whatsapp',
                    title: 'National Final - Countdown',
                    description: 'Final countdown and logistics'
                });
                
                events.push({
                    date: dates.nationalDate,
                    award: 'UKSUA',
                    channel: 'social',
                    title: 'National Final Event',
                    description: 'Live coverage of UK StartUp Awards National Final'
                });
                
                events.push({
                    date: addDays(dates.nationalDate, 1),
                    award: 'UKSUA',
                    channel: 'email',
                    title: 'Winner Package',
                    description: 'Send winner assets and recognition materials'
                });
            }
            
            return events;
        }
        
        // Generate events for GBEA
        function generateGBEAEvents(dates) {
            const events = [];
            
            if (dates.applicationDeadline) {
                events.push({
                    date: subtractDays(dates.applicationDeadline, 42),
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Cold Outreach Campaign',
                    description: 'Target entrepreneurs with award opportunity'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 28),
                    award: 'GBEA',
                    channel: 'social',
                    title: 'Social Media Campaign',
                    description: 'Multi-channel entrepreneur targeting'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 2),
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Final Completion Reminder',
                    description: 'Urgent deadline reminder'
                });
                
                events.push({
                    date: dates.applicationDeadline,
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Application Deadline',
                    description: 'Applications close'
                });
            }
            
            if (dates.shortlistDate) {
                events.push({
                    date: dates.shortlistDate,
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Shortlist Announcement',
                    description: 'Congratulations and event details'
                });
                
                events.push({
                    date: addDays(dates.shortlistDate, 2),
                    award: 'GBEA',
                    channel: 'call',
                    title: 'Personal Congratulations',
                    description: 'Call shortlisted entrepreneurs'
                });
            }
            
            if (dates.finalEvent) {
                events.push({
                    date: subtractDays(dates.finalEvent, 14),
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Pre-Event Build-Up',
                    description: 'Meet the judges and category insights'
                });
                
                events.push({
                    date: subtractDays(dates.finalEvent, 1),
                    award: 'GBEA',
                    channel: 'whatsapp',
                    title: 'Event Reminder',
                    description: 'Final logistics and reminders'
                });
                
                events.push({
                    date: dates.finalEvent,
                    award: 'GBEA',
                    channel: 'social',
                    title: 'Final Event',
                    description: 'Live coverage of Great British Entrepreneur Awards'
                });
                
                events.push({
                    date: addDays(dates.finalEvent, 1),
                    award: 'GBEA',
                    channel: 'email',
                    title: 'Post-Event Thank You',
                    description: 'Photos and feedback survey'
                });
            }
            
            return events;
        }
        
        // Generate events for GBIA
        function generateGBIAEvents(dates) {
            const events = [];
            
            if (dates.applicationDeadline) {
                events.push({
                    date: subtractDays(dates.applicationDeadline, 42),
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Industry Sector Targeting',
                    description: 'Industry-specific messaging campaign'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 28),
                    award: 'GBIA',
                    channel: 'social',
                    title: 'LinkedIn Campaign',
                    description: 'B2B decision-maker targeting'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 2),
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Deadline Reminder',
                    description: 'Final completion reminder'
                });
                
                events.push({
                    date: dates.applicationDeadline,
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Application Deadline',
                    description: 'Applications close'
                });
            }
            
            if (dates.shortlistDate) {
                events.push({
                    date: dates.shortlistDate,
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Shortlist Announcement',
                    description: 'Industry recognition and gala invitation'
                });
                
                events.push({
                    date: addDays(dates.shortlistDate, 2),
                    award: 'GBIA',
                    channel: 'call',
                    title: 'Personal Recognition Call',
                    description: 'Partnership opportunities discussion'
                });
            }
            
            if (dates.finalEvent) {
                events.push({
                    date: subtractDays(dates.finalEvent, 14),
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Pre-Event Experience Builder',
                    description: 'Industry networking and judge profiles'
                });
                
                events.push({
                    date: subtractDays(dates.finalEvent, 1),
                    award: 'GBIA',
                    channel: 'whatsapp',
                    title: 'Final Details',
                    description: 'Logistics and arrival information'
                });
                
                events.push({
                    date: dates.finalEvent,
                    award: 'GBIA',
                    channel: 'social',
                    title: 'Gala Event',
                    description: 'Live coverage of Great British Industry Awards'
                });
                
                events.push({
                    date: addDays(dates.finalEvent, 1),
                    award: 'GBIA',
                    channel: 'email',
                    title: 'Post-Event Follow-Up',
                    description: 'Professional gallery and feedback'
                });
            }
            
            return events;
        }
        
        // Generate events for FGI
        function generateFGIEvents(dates) {
            const events = [];
            
            if (dates.applicationDeadline) {
                events.push({
                    date: subtractDays(dates.applicationDeadline, 56),
                    award: 'FGI',
                    channel: 'email',
                    title: 'Growth Company Targeting',
                    description: 'Target high-growth companies'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 42),
                    award: 'FGI',
                    channel: 'social',
                    title: 'Data-Driven Campaign',
                    description: 'Growth statistics and sector trends'
                });
                
                events.push({
                    date: subtractDays(dates.applicationDeadline, 2),
                    award: 'FGI',
                    channel: 'email',
                    title: 'Completion Support',
                    description: 'Data submission deadline reminder'
                });
                
                events.push({
                    date: dates.applicationDeadline,
                    award: 'FGI',
                    channel: 'email',
                    title: 'Application Deadline',
                    description: 'Applications close'
                });
            }
            
            if (dates.rankingDate) {
                events.push({
                    date: dates.rankingDate,
                    award: 'FGI',
                    channel: 'email',
                    title: 'Ranking Announcement',
                    description: 'Congratulations and rank reveal'
                });
                
                events.push({
                    date: addDays(dates.rankingDate, 2),
                    award: 'FGI',
                    channel: 'call',
                    title: 'Personal Recognition',
                    description: 'Discussion of ranking and opportunities'
                });
            }
            
            if (dates.celebrationEvent) {
                events.push({
                    date: subtractDays(dates.celebrationEvent, 7),
                    award: 'FGI',
                    channel: 'email',
                    title: 'Pre-Event Experience',
                    description: 'Who's attending and networking tips'
                });
                
                events.push({
                    date: subtractDays(dates.celebrationEvent, 1),
                    award: 'FGI',
                    channel: 'whatsapp',
                    title: 'Event Reminder',
                    description: 'Final logistics'
                });
                
                events.push({
                    date: dates.celebrationEvent,
                    award: 'FGI',
                    channel: 'social',
                    title: 'Celebration Event',
                    description: 'Live updates and top 10 reveals'
                });
                
                events.push({
                    date: addDays(dates.celebrationEvent, 1),
                    award: 'FGI',
                    channel: 'email',
                    title: 'Post-Event Thank You',
                    description: 'Event highlights and photos'
                });
            }
            
            return events;
        }
        
        // Load all award dates and generate events
        async function loadAllEvents() {
            try {
                allEvents = [];
                
                // Load UKSUA
                const uksuaDoc = await db.collection('awards').doc('uksua').get();
                if (uksuaDoc.exists) {
                    allEvents = allEvents.concat(generateUKSUAEvents(uksuaDoc.data()));
                }
                
                // Load GBEA
                const gbeaDoc = await db.collection('awards').doc('gbea').get();
                if (gbeaDoc.exists) {
                    allEvents = allEvents.concat(generateGBEAEvents(gbeaDoc.data()));
                }
                
                // Load GBIA
                const gbiaDoc = await db.collection('awards').doc('gbia').get();
                if (gbiaDoc.exists) {
                    allEvents = allEvents.concat(generateGBIAEvents(gbiaDoc.data()));
                }
                
                // Load FGI
                const fgiDoc = await db.collection('awards').doc('fgi').get();
                if (fgiDoc.exists) {
                    allEvents = allEvents.concat(generateFGIEvents(fgiDoc.data()));
                }
                
                // Sort events by date
                allEvents.sort((a, b) => {
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    return new Date(a.date) - new Date(b.date);
                });
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                displayEvents();
                
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('loading').innerHTML = 'Error loading calendar. Please refresh the page.';
            }
        }
        
        // Display events based on filters
        function displayEvents() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let filteredEvents = allEvents.filter(event => {
                // Filter by date (upcoming only)
                if (!event.date) return false;
                const eventDate = new Date(event.date);
                if (eventDate < today) return false;
                
                // Filter by award
                if (currentAwardFilter !== 'all' && event.award !== currentAwardFilter) {
                    return false;
                }
                
                // Filter by channel
                if (currentChannelFilter !== 'all' && event.channel !== currentChannelFilter) {
                    return false;
                }
                
                return true;
            });
            
            const eventsList = document.getElementById('eventsList');
            
            if (filteredEvents.length === 0) {
                eventsList.innerHTML = '<div class="no-events">No upcoming events match your filters. Try adjusting the filters or setting dates on your award pages.</div>';
                return;
            }
            
            eventsList.innerHTML = filteredEvents.map(event => {
                const eventDate = new Date(event.date);
                const dateStr = eventDate.toLocaleDateString('en-GB', { 
                    weekday: 'short',
                    day: 'numeric', 
                    month: 'short',
                    year: 'numeric'
                });
                
                return `
                    <div class="event-item event-${event.award.toLowerCase()}">
                        <div class="event-header">
                            <div class="event-date">${dateStr}</div>
                            <span class="channel-badge channel-${event.channel}">${getChannelIcon(event.channel)} ${event.channel.toUpperCase()}</span>
                        </div>
                        <div class="event-award">${event.award}</div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-description">${event.description}</div>
                    </div>
                `;
            }).join('');
        }
        
        function getChannelIcon(channel) {
            const icons = {
                email: 'üìß',
                call: 'üìû',
                whatsapp: 'üí¨',
                social: 'üì±'
            };
            return icons[channel] || '';
        }
        
        function filterByAward(award) {
            currentAwardFilter = award;
            
            // Update button styles
            document.querySelectorAll('.filter-group')[0].querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayEvents();
        }
        
        function filterByChannel(channel) {
            currentChannelFilter = channel;
            
            // Update button styles
            document.querySelectorAll('.filter-group')[1].querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayEvents();
        }
        
        // Load events when page loads
        loadAllEvents();
    </script>
</body>
</html>
